<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Solicitud de crÃ©dito</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ’³</text></svg>" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1:#0f172a; --bg2:#111827; --card:#0b1220;
      --acc:#22d3ee; --acc2:#a78bfa; --text:#e5e7eb; --muted:#9ca3af;
      --shadow:0 20px 60px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);
      --radius:22px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Poppins,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:var(--text);
      background: radial-gradient(1200px 800px at 10% -10%, #1f2a44 0%, transparent 55%),
                  radial-gradient(900px 600px at 110% 10%, #2a1f44 0%, transparent 60%),
                  linear-gradient(180deg, var(--bg1), var(--bg2));
      display:grid; place-items:center; padding:24px;
    }
    .shell{width:min(880px,92vw); display:grid; gap:18px; animation:fadeIn .5s ease both}
    @keyframes fadeIn{from{opacity:0; transform:translateY(6px)}to{opacity:1; transform:none}}

    .header{
      background:linear-gradient(135deg, rgba(34,211,238,.12), rgba(167,139,250,.12));
      border:1px solid rgba(255,255,255,.08); box-shadow:var(--shadow);
      padding:22px 24px; border-radius:var(--radius);
    }
    .headline{font-weight:700; font-size:clamp(20px,2.3vw,28px); letter-spacing:.2px}
    .sub{margin-top:6px; color:var(--muted); font-weight:500}

    .card{
      background:linear-gradient(145deg, rgba(255,255,255,.02), transparent);
      border:1px solid rgba(255,255,255,.08); box-shadow:var(--shadow);
      border-radius:var(--radius); padding:22px;
    }

    .row{display:grid; grid-template-columns:160px 1fr auto; align-items:center; gap:12px; padding:14px 10px; border-bottom:1px solid rgba(255,255,255,.06)}
    .row:last-child{border-bottom:none}
    .label{color:var(--muted); font-weight:600}
    .value{font-weight:600; letter-spacing:.2px}
    .copy{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08); padding:8px 12px; border-radius:12px;
      color:var(--text); cursor:pointer; transition:transform .05s ease, border-color .2s ease; user-select:none;
    }
    .copy:hover{border-color:rgba(34,211,238,.45)}
    .copy:active{transform:translateY(1px)}
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      background:linear-gradient(135deg, rgba(16,185,129,.16), rgba(34,211,238,.14));
      color:#d1fae5; border:1px solid rgba(16,185,129,.35);
      padding:8px 12px; border-radius:999px; font-weight:600; font-size:14px;
    }

    .footer{display:flex; gap:10px; justify-content:flex-end; margin-top:6px}
    .btn{
      padding:12px 16px; border-radius:14px; border:1px solid rgba(255,255,255,.1);
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      color:var(--text); cursor:pointer; font-weight:700; letter-spacing:.3px;
      transition:transform .06s ease, border-color .2s ease, filter .2s ease;
    }
    .btn:hover{border-color:rgba(167,139,250,.6)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{
      background:linear-gradient(135deg, rgba(34,211,238,.25), rgba(167,139,250,.22));
      border-color:rgba(34,211,238,.55);
      filter:drop-shadow(0 10px 24px rgba(34,211,238,.15));
    }

    .loading{display:grid; gap:12px; margin-top:8px}
    .shimmer{height:18px; border-radius:10px; background:linear-gradient(90deg, rgba(255,255,255,.05), rgba(255,255,255,.12), rgba(255,255,255,.05)); background-size:200% 100%; animation:sh 1.1s linear infinite}
    @keyframes sh{to{background-position:-200% 0}}

    .error{margin-top:10px; padding:12px 14px; border-radius:14px; background:linear-gradient(135deg, rgba(244,63,94,.16), rgba(239,68,68,.12)); border:1px solid rgba(244,63,94,.35); color:#fecaca; font-weight:600}
  </style>
</head>
<body>
  <div class="shell">
    <section class="header">
      <div class="headline">Hey Luis, tenemos una solicitud de crÃ©dito</div>
      <div class="sub">Estos son los datos del solicitante</div>
    </section>

    <section class="card" id="card">
      <div class="badge" id="status">Cargando datosâ€¦</div>

      <div id="loading" class="loading" aria-hidden="true">
        <div class="shimmer" style="width:40%"></div>
        <div class="shimmer" style="width:65%"></div>
        <div class="shimmer" style="width:50%"></div>
      </div>

      <div id="rows" style="display:none">
        <div class="row">
          <div class="label">CÃ©dula</div>
          <div class="value" id="cedula">â€”</div>
          <button class="copy" data-copy-target="#cedula">Copiar</button>
        </div>
        <div class="row">
          <div class="label">Nombre</div>
          <div class="value" id="nombre">â€”</div>
          <button class="copy" data-copy-target="#nombre">Copiar</button>
        </div>
        <div class="row">
          <div class="label">TelÃ©fono</div>
          <div class="value" id="telefono">â€”</div>
          <button class="copy" data-copy-target="#telefono">Copiar</button>
        </div>

        <div class="footer">
          <button class="btn" id="rechazar">Rechazar</button>
          <button class="btn primary" id="aprobar">Aprobar</button>
        </div>
      </div>

      <div id="err" class="error" style="display:none"></div>
    </section>
  </div>

  <script>
  // ===== Config =====
  const BASE   = "https://privsupabase.luispinta.com/functions/v1/main";
  const TOKEN  = "ansbsjabshsyt22526gsyhgw6tw6qg822wg27"; // rota este valor cuando termines las pruebas
  const TABLE  = "pruebas";
  const ID_DEFAULT = 9; // si no viene ?id= en la URL, usa este

  // ===== Helpers =====
  const $ = (s) => document.querySelector(s);
  const setText = (sel, val) => { const el = $(sel); if (el) el.textContent = val ?? "â€”"; };

  function getIdFromQuery() {
    const u = new URL(location.href);
    return u.searchParams.get("id") ?? ID_DEFAULT;
  }

  function buildUrl() {
    const u = new URL(BASE);
    u.searchParams.set("table", TABLE);
    u.searchParams.set("id", String(getIdFromQuery()));
    u.searchParams.set("select", "cedula,nombre,telefono");
    u.searchParams.set("limit", "1");
    return u.toString();
  }

  async function load() {
    try {
      const url = buildUrl();
      console.log("Intentando conectar a:", url);
      
      const r = await fetch(url, {
        headers: { "X-API-Token": TOKEN }
      });

      if (!r.ok) {
        const errorText = await r.text().catch(() => '');
        throw new Error(HTTP ${r.status}: ${r.statusText}${errorText ? ' - ' + errorText : ''});
      }
      
      const payload = await r.json();
      console.log("Respuesta recibida:", payload);

      const row = Array.isArray(payload?.data) ? payload.data[0] : null;
      if (!row) throw new Error("No se encontrÃ³ el registro solicitado.");

      setText("#cedula",  row.cedula);
      setText("#nombre",  row.nombre);
      setText("#telefono",row.telefono);

      $("#status").textContent = "Datos listos";
      $("#loading").style.display = "none";
      $("#rows").style.display = "";
    } catch (err) {
      console.error("Error al cargar datos:", err);
      $("#loading").style.display = "none";
      $("#err").style.display = "";
      
      let errorMessage = "Error de conexiÃ³n";
      if (err.message.includes("Failed to fetch") || err.message.includes("Network")) {
        errorMessage = "Error de conexiÃ³n: Verifica tu conexiÃ³n a internet o la URL del servidor";
      } else if (err.message.includes("CORS")) {
        errorMessage = "Error de CORS: El servidor no permite conexiones desde este dominio";
      } else if (err.message.includes("404")) {
        errorMessage = "Error 404: El endpoint no existe";
      } else {
        errorMessage = "Error: " + (err?.message || err);
      }
      
      $("#err").textContent = errorMessage;
      $("#status").textContent = "OcurriÃ³ un problema";
    }
  }

  // Copiar al portapapeles
  document.addEventListener("click", async (e) => {
    const btn = e.target.closest(".copy");
    if (!btn) return;
    const sel = btn.getAttribute("data-copy-target");
    const val = $(sel)?.textContent?.trim();
    if (!val || val === "â€”") return;
    
    try {
      await navigator.clipboard.writeText(val);
      const old = btn.textContent; 
      btn.textContent = "Copiado âœ“";
      setTimeout(() => btn.textContent = old, 900);
    } catch (err) {
      console.warn("No se pudo copiar al portapapeles:", err);
      // Fallback para navegadores sin soporte de clipboard API
      const old = btn.textContent;
      btn.textContent = "Selecciona y copia";
      setTimeout(() => btn.textContent = old, 1500);
    }
  });

  // Acciones (demo visual)
  $("#aprobar").addEventListener("click", () => {
    $("#status").textContent = "Aprobado âœ“";
    $("#status").style.background = "linear-gradient(135deg, rgba(16,185,129,.22), rgba(34,211,238,.2))";
  });
  $("#rechazar").addEventListener("click", () => {
    $("#status").textContent = "Rechazado âœ—";
    $("#status").style.background = "linear-gradient(135deg, rgba(244,63,94,.22), rgba(239,68,68,.18))";
  });

  load();
  </script>
</body>
</html>
